<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>My Appointments - Medicore</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <link href="../../assets/img/favicon.png" rel="icon">
    <link href="../../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link href="../../assets/css/style.css" rel="stylesheet">

    <style>
        :root {
            --primary: #0b6fbf;
            --accent: #07a0f7;
            --danger: #e53935;
            --muted: #6b7c85;
        }

        body {
            background:#f5f7fb;
            color:#072a4b;
            font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
        }

        /* Remove underline from logo */
        .logo {
            text-decoration: none !important;
        }
        .logo:hover {
            text-decoration: none !important;
        }
        .logo span {
            text-decoration: none !important;
        }

        .container-body {
            max-width:1100px;
            margin:28px auto;
            padding:0 12px 60px;
        }

        .section-card {
            background:#fff;
            border:1px solid #e9f3fb;
            border-radius:10px;
            padding:14px;
            margin-bottom:16px;
            box-shadow:0 6px 18px rgba(11,111,191,0.03);
        }

        .section-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:12px;
        }
        .section-title {
            font-weight:700;
            color:#072a4b;
            font-size:18px;
        }
        .count-badge {
            background:var(--accent);
            color:#fff;
            padding:6px 10px;
            border-radius:999px;
            font-weight:700;
            font-size:13px;
        }

        .appt-item {
            border:1px solid #f0f6fb;
            padding:12px;
            border-radius:8px;
            margin-bottom:10px;
            display:flex;
            gap:12px;
            align-items:center;
            cursor:pointer;
            background:#fff;
            transition: all 0.2s ease;
        }
        .appt-item:hover {
            background:#fbfeff;
            box-shadow:0 4px 12px rgba(7,160,247,0.08);
        }

        .appt-main { flex:1; min-width:0; }
        .appt-doctor { font-weight:700; color:#072a4b; font-size:16px; }
        .appt-location { color:#485f6a; font-size:14px; margin-top:4px; }
        .appt-datetime {
            text-align:right;
            min-width:150px;
            color:#072a4b;
            font-weight:700;
        }

        .past-list {
            max-height:420px;
            overflow:auto;
            padding-right:6px;
        }
        .past-item {
            border-bottom:1px dashed #e9f3fa;
            padding:10px 0;
            display:flex;
            justify-content:space-between;
            gap:12px;
            align-items:center;
            cursor:pointer;
            transition: background 0.2s ease;
            border-radius:4px;
            padding:10px;
            margin-bottom:4px;
        }
        .past-item:hover {
            background:#f8fafb;
        }
        .past-title { font-weight:700; }
        .past-meta { color:#6d7f86; font-size:14px; }

        .empty-state {
            text-align:center;
            color:#6d7f86;
            padding:18px;
            font-weight:600;
            display:none;
        }

        /* Appointment Details Card */
        .appt-details-card {
            background:#fff;
            border:1px solid #e9f3fb;
            border-radius:12px;
            padding:24px;
            box-shadow:0 6px 18px rgba(11,111,191,0.08);
            position:relative;
        }

        /* REMOVED .close-icon CSS AND HTML */

        .detail-row {
            padding:12px 0;
            border-bottom:1px solid #f0f4f8;
        }
        .detail-row:last-child {
            border-bottom:none;
        }
        .detail-label {
            font-weight:700;
            color:var(--primary);
            margin-bottom:4px;
            font-size:14px;
        }
        .detail-value {
            color:#072a4b;
            font-size:15px;
        }

        .status-badge {
            display:inline-block;
            padding:6px 12px;
            border-radius:6px;
            font-weight:700;
            font-size:13px;
        }
        .status-upcoming {
            background:#e8f5e9;
            color:#2e7d32;
        }
        .status-completed {
            background:#e3f2fd;
            color:#1565c0;
        }
        .status-cancelled {
            background:#ffebee;
            color:#c62828;
        }

        /* Fix header dropdowns z-index */
        .header-nav .dropdown-menu {
            z-index: 9999 !important;
        }
        
        /* Style for the new back button */
        /* Update the CSS in your <style> block */
        .back-button-top-right {
            position: absolute;
            top: 16px; /* Adjust as needed */
            right: 16px; /* Adjust as needed */
            z-index: 10;
        }

        @media (max-width:767px) {
            .appt-datetime {
                text-align:left;
                min-width:0;
                margin-top:8px;
            }
        }
    </style>
</head>

<body>
    <header id="header" class="header fixed-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-between">
            <a href="patientBookAppointment.html" class="logo d-flex align-items-center">
                <img src="../../assets/img/logo.png" alt="">
                <span class="d-none d-lg-block">Medicore</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div>
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle " href="#"><i class="bi bi-search"></i></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-bell"></i>
                        <span class="badge bg-primary badge-number">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
                        <li class="dropdown-header">
                            You have 3 new notifications
                            <a href="patient-notification-page.html"><span class="badge rounded-pill bg-primary p-2 ms-2">View all</span></a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="notification-item">
                            <i class="bi bi-info-circle text-primary"></i>
                            <div>
                                <h4>Profile Updated</h4>
                                <p>Dr. Mehta updated his contact details.</p>
                                <p>1 hr. ago</p>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <span class="d-none d-md-block dropdown-toggle ps-2">Dhanush</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li class="dropdown-header">
                            <h6>Dhanush</h6>
                            <span>esdhanush@gmail.com</span>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item d-flex align-items-center" href="patientProfile.html"><i class="bi bi-person"></i><span>My Profile</span></a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item d-flex align-items-center" href="../login/patientLogin.html"><i class="bi bi-box-arrow-right"></i><span>Sign Out</span></a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <aside id="sidebar" class="sidebar">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-heading">Pages</li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="patientBookAppointment.html">
                    <i class="ri ri-stethoscope-fill"></i>
                    <span>Book Appointment</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="patientAppointments.html">
                    <i class="ri ri-health-book-line"></i>
                    <span>My Appointments</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="patientProfile.html">
                    <i class="ri ri-profile-line"></i>
                    <span>My Profile</span>
                </a>
            </li>
        </ul>
    </aside>

    <main id="main" class="main">
        <div class="pagetitle" style="margin-bottom:10px;">
            <h1 style="margin:0 0 6px 0">My Appointments</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb" style="background:transparent;padding:0;margin:0;">
                    <li class="breadcrumb-item"><a href="patientBookAppointment.html">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">My Appointments</li>
                </ol>
            </nav>
        </div>

        <div class="container-body" id="appointmentsListPage">
            <div class="section-card" id="upcomingSection">
                <div class="section-header">
                    <div class="section-title">Upcoming Appointments</div>
                    <div class="count-badge" id="upcomingCount">2</div>
                </div>

                <div class="appt-item" data-appt-id="A1001" data-status="upcoming" data-doctor="Dr. Mehta" data-location="Apollo Speciality Hospital, Chennai" data-date="Fri, 02 Oct 2025" data-time="10:30 AM" data-specialization="Cardiology">
                    <div class="appt-main">
                        <div class="appt-doctor">Dr. Mehta</div>
                        <div class="appt-location">Apollo Speciality Hospital, Chennai</div>
                    </div>
                    <div class="appt-datetime">
                        <div>Fri, 02 Oct 2025</div>
                        <div style="font-weight:700;margin-top:4px;">10:30 AM</div>
                    </div>
                </div>

                <div class="appt-item" data-appt-id="A1002" data-status="upcoming" data-doctor="Dr. Sudhir Naik" data-location="Apollo Health City, Jubilee Hills" data-date="Mon, 06 Oct 2025" data-time="04:15 PM" data-specialization="Cardiac Sciences">
                    <div class="appt-main">
                        <div class="appt-doctor">Dr. Sudhir Naik</div>
                        <div class="appt-location">Apollo Health City, Jubilee Hills</div>
                    </div>
                    <div class="appt-datetime">
                        <div>Mon, 06 Oct 2025</div>
                        <div style="font-weight:700;margin-top:4px;">04:15 PM</div>
                    </div>
                </div>

                <div id="upcomingEmpty" class="empty-state">No upcoming appointments</div>
            </div>

            <div class="section-card">
                <div class="section-header">
                    <div class="section-title">Past Appointments</div>
                    <div class="count-badge" id="pastCount">3</div>
                </div>

                <div class="past-list" id="pastList">
                    <div class="past-item" data-past-id="P1" data-status="completed" data-doctor="Dr. Mehta" data-location="Apollo Speciality Hospital, Chennai" data-date="12 Jul 2025" data-time="11:00 AM" data-specialization="Cardiology">
                        <div>
                            <div class="past-title">Dr. Mehta</div>
                            <div class="past-meta">Cardiology — 12 Jul 2025</div>
                        </div>
                        <div style="text-align:right;">
                            <div class="past-meta">COMPLETED</div>
                        </div>
                    </div>

                    <div class="past-item" data-past-id="P2" data-status="completed" data-doctor="Dr. Sudhir Naik" data-location="Apollo Health City, Jubilee Hills" data-date="03 Jun 2025" data-time="02:30 PM" data-specialization="Cardiac Sciences">
                        <div>
                            <div class="past-title">Dr. Sudhir Naik</div>
                            <div class="past-meta">Cardiac Sciences — 03 Jun 2025</div>
                        </div>
                        <div style="text-align:right;">
                            <div class="past-meta">COMPLETED</div>
                        </div>
                    </div>

                    <div class="past-item" data-past-id="P3" data-status="cancelled" data-doctor="Dr. N Sastri" data-location="Apollo Hospitals, Delhi" data-date="10 May 2025" data-time="04:00 PM" data-specialization="Cardiac Sciences">
                        <div>
                            <div class="past-title">Dr. N Sastri</div>
                            <div class="past-meta">Cardiac Sciences — 10 May 2025</div>
                        </div>
                        <div style="text-align:right;">
                            <div class="past-meta">CANCELLED</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="container-body d-none" id="appointmentDetailsPage">
            <div class="appt-details-card">
                
                <div class="back-button-top-right">
                    <button class="btn btn-outline-primary btn-sm" id="closeDetailsBtn" title="Back to Appointments">
                        <i class="bi bi-arrow-left me-1"></i> Back
                    </button>
                </div>
                
                <h3 style="color:#072a4b; font-weight:800; margin-bottom:20px;" id="detailsTitle">Appointment Details</h3>

                <div class="detail-row">
                    <div class="detail-label">Patient Name</div>
                    <div class="detail-value">Dhanush</div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Doctor</div>
                    <div class="detail-value" id="detailDoctor"></div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Specialization</div>
                    <div class="detail-value" id="detailSpecialization"></div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Hospital</div>
                    <div class="detail-value" id="detailLocation"></div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Appointment Date</div>
                    <div class="detail-value" id="detailDate"></div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Appointment Time</div>
                    <div class="detail-value" id="detailTime"></div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">
                        <span class="status-badge" id="detailStatus"></span>
                    </div>
                </div>

                <div class="detail-row d-none" id="notesRow">
                    <div class="detail-label">Notes</div>
                    <textarea class="form-control mt-2" id="detailNotes" rows="3" placeholder="Add any notes about this appointment (optional)" style="background:#f8f9fa; resize:none;"></textarea>
                </div>

                <div class="d-flex justify-content-end gap-3 mt-4" id="actionButtons">
                    <button class="btn btn-outline-danger btn-lg" id="cancelApptBtn">
                        <i class="bi bi-x-circle me-2"></i>Cancel Appointment
                    </button>
                </div>
            </div>
        </div>

    </main><a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <div class="modal fade" id="cancelConfirmModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cancel Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to cancel this appointment?</p>
                    <p class="text-muted small">This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, Keep It</button>
                    <button type="button" class="btn btn-danger" id="confirmCancelBtn">Yes, Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="../../assets/js/sidebar.js"></script>
    <script src="../../assets/js/main.js"></script>

    <script>
        $(function(){
            
            var currentApptData = {};

            // Initialize Bootstrap components
            var dropdownElementList = [].slice.call(document.querySelectorAll('[data-bs-toggle="dropdown"]'));
            var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                return new bootstrap.Dropdown(dropdownToggleEl);
            });

            // Function to update the appointment counts in the UI
            function updateCounts(){
                var upcoming = $('#upcomingSection .appt-item').length;
                var past = $('#pastList .past-item').length;
                $('#upcomingCount').text(upcoming);
                $('#pastCount').text(past);
                $('#upcomingEmpty').toggle(upcoming === 0);
            }
            
            // Click handler for an upcoming appointment item
            $(document).on('click', '.appt-item', function(){
                var $item = $(this);
                
                // Gather data from the clicked element
                currentApptData = {
                    id: $item.data('appt-id'),
                    status: $item.data('status'),
                    doctor: $item.data('doctor'),
                    location: $item.data('location'),
                    date: $item.data('date'),
                    time: $item.data('time'),
                    specialization: $item.data('specialization') || 'General Medicine'
                };

                // Populate the details page with the data
                $('#detailDoctor').text(currentApptData.doctor);
                $('#detailSpecialization').text(currentApptData.specialization);
                $('#detailLocation').text(currentApptData.location);
                $('#detailDate').text(currentApptData.date);
                $('#detailTime').text(currentApptData.time);
                
                // Set the status badge
                var $statusBadge = $('#detailStatus');
                $statusBadge.removeClass('status-upcoming status-completed status-cancelled');
                $statusBadge.addClass('status-upcoming').text('UPCOMING');

                // Show action buttons and hide notes section for upcoming appointments
                $('#actionButtons').removeClass('d-none').addClass('d-flex'); 
                $('#notesRow').addClass('d-none'); 
                $('#detailNotes').prop('readonly', false).val(''); // Clear notes

                // Switch views
                $('#appointmentsListPage').hide();
                $('#appointmentDetailsPage').removeClass('d-none').show();
                $('html, body').animate({ scrollTop: 0 }, 300); // Scroll to top
            });

            // Click handler for a past appointment item
            $(document).on('click', '.past-item', function(){
                var $item = $(this);
                
                // Gather data from the clicked element
                currentApptData = {
                    id: $item.data('past-id'),
                    status: $item.data('status'),
                    doctor: $item.data('doctor'),
                    location: $item.data('location'),
                    date: $item.data('date'),
                    time: $item.data('time'),
                    specialization: $item.data('specialization') || 'General Medicine'
                };

                // Populate the details page with the data
                $('#detailDoctor').text(currentApptData.doctor);
                $('#detailSpecialization').text(currentApptData.specialization);
                $('#detailLocation').text(currentApptData.location);
                $('#detailDate').text(currentApptData.date);
                $('#detailTime').text(currentApptData.time);
                
                // Set the status badge based on status
                var $statusBadge = $('#detailStatus');
                $statusBadge.removeClass('status-upcoming status-completed status-cancelled');
                if(currentApptData.status === 'completed'){
                    $statusBadge.addClass('status-completed').text('COMPLETED');
                } else if(currentApptData.status === 'cancelled'){
                    $statusBadge.addClass('status-cancelled').text('CANCELLED');
                }

                // Hide action buttons and show notes section for past appointments
                $('#actionButtons').removeClass('d-flex').addClass('d-none'); 
                $('#notesRow').removeClass('d-none');
                
                // Populate the notes field based on status
                var $notesField = $('#detailNotes');
                $notesField.prop('readonly', true);
                if(currentApptData.status === 'completed'){
                    $notesField.val('Appointment completed successfully. General checkup performed. Patient advised to maintain healthy lifestyle and follow prescribed medication.');
                } else if(currentApptData.status === 'cancelled'){
                    $notesField.val('This appointment was cancelled. Please book a new appointment if you need medical consultation.');
                } else {
                    $notesField.val(''); // Clear notes for any other case
                }

                // Switch views
                $('#appointmentsListPage').hide();
                $('#appointmentDetailsPage').removeClass('d-none').show();
                $('html, body').animate({ scrollTop: 0 }, 300); // Scroll to top
            });

            // Click handler for the close/back button on the details page
            $('#closeDetailsBtn').on('click', function(){
                $('#appointmentDetailsPage').addClass('d-none').hide();
                $('#appointmentsListPage').show();
                $('html, body').animate({ scrollTop: 0 }, 300);
            });

            // Click handler to open the cancellation confirmation modal
            $('#cancelApptBtn').on('click', function(){
                var cancelModal = new bootstrap.Modal(document.getElementById('cancelConfirmModal'));
                cancelModal.show();
            });

            // Click handler to confirm the cancellation
            $('#confirmCancelBtn').on('click', function(){
                var apptId = currentApptData.id;
                
                // Find the original upcoming appointment item
                var $item = $('.appt-item').filter(function(){ 
                    return $(this).data('appt-id') == apptId; 
                }).first();

                if($item.length){
                    // Get details from the stored data
                    var doctor = currentApptData.doctor;
                    var loc = currentApptData.location;
                    var dateText = currentApptData.date;
                    var specialization = currentApptData.specialization;
                    var time = currentApptData.time;
                    var pastMeta = specialization + ' — ' + dateText;

                    // Create a new "past item" element with 'cancelled' status
                    var $past = $('<div class="past-item" data-past-id="'+ apptId +'" data-status="cancelled" data-doctor="'+ doctor +'" data-location="'+ loc +'" data-date="'+ dateText +'" data-time="'+ time +'" data-specialization="'+ specialization +'"></div>');
                    var left = $('<div></div>');
                    left.append('<div class="past-title"></div>').find('div').first().text(doctor);
                    left.append('<div class="past-meta"></div>').find('div').last().text(pastMeta);
                    var right = $('<div style="text-align:right;"><div class="past-meta">CANCELLED</div></div>');
                    $past.append(left).append(right);

                    // Add the new cancelled item to the past list
                    $('#pastList').prepend($past);

                    // Remove the original item from the upcoming list
                    $item.remove();

                    // Refresh the counts
                    updateCounts();
                }

                // Hide the confirmation modal
                var cancelModal = bootstrap.Modal.getInstance(document.getElementById('cancelConfirmModal'));
                cancelModal.hide();

                // Go back to the main list view
                $('#appointmentDetailsPage').addClass('d-none').hide();
                $('#appointmentsListPage').show();
                $('html, body').animate({ scrollTop: 0 }, 300);
            });

            // Run initial count on page load
            updateCounts();
        });
    </script>
</body>
</html>